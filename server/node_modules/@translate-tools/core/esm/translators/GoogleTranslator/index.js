var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __read = (this && this.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
import axios from 'axios';
import { stringify } from 'query-string';
import xpath from 'xpath';
import { DOMParser } from '@xmldom/xmldom';
import { BaseTranslator } from '../../util/BaseTranslator';
import { getToken } from './token';
import { visitArrayItems } from './utils';
import { getLanguageCodesISO639v2 } from '../../util/languages';
/**
 * Map with languages aliases.
 *
 * Google translator use legacy codes for some languages,
 * this map useful to use actual language codes by aliases
 *
 * @link https://xml.coverpages.org/iso639a.html
 */
var fixedLanguagesMap = {
    he: 'iw',
    jv: 'jw',
};
/**
 * Raw languages array
 */
// eslint-disable
// prettier-ignore
export var supportedLanguages = [
    'af', 'ak', 'am', 'ar', 'as', 'ay', 'az', 'be', 'bg', 'bho',
    'bm', 'bn', 'bs', 'ca', 'ceb', 'ckb', 'co', 'cs', 'cy', 'da',
    'de', 'doi', 'dv', 'ee', 'el', 'en', 'eo', 'es', 'et', 'eu',
    'fa', 'fi', 'fr', 'fy', 'ga', 'gd', 'gl', 'gn', 'gom', 'gu',
    'ha', 'haw', 'hi', 'hmn', 'hr', 'ht', 'hu', 'hy', 'id', 'ig',
    'ilo', 'is', 'it', 'iw', 'ja', 'jw', 'ka', 'kk', 'km', 'kn',
    'ko', 'kri', 'ku', 'ky', 'la', 'lb', 'lg', 'ln', 'lo', 'lt',
    'lus', 'lv', 'mai', 'mg', 'mi', 'mk', 'ml', 'mn', 'mni-Mtei', 'mr',
    'ms', 'mt', 'my', 'ne', 'nl', 'no', 'nso', 'ny', 'om', 'or',
    'pa', 'pl', 'ps', 'pt', 'qu', 'ro', 'ru', 'rw', 'sa', 'sd',
    'si', 'sk', 'sl', 'sm', 'sn', 'so', 'sq', 'sr', 'st', 'su',
    'sv', 'sw', 'ta', 'te', 'tg', 'th', 'ti', 'tk', 'tl', 'tr',
    'ts', 'tt', 'ug', 'uk', 'ur', 'uz', 'vi', 'xh', 'yi', 'yo',
    'zh-CN', 'zh-TW', 'zu'
];
// eslint-enable
var parseXMLResponse = function (text) {
    var doc;
    try {
        doc = new DOMParser().parseFromString(text);
    }
    catch (err) {
        console.error(err);
        return null;
    }
    var nodesWithTranslation = xpath.select('//pre/*[not(self::i)]', doc);
    if (nodesWithTranslation.length === 0)
        return null;
    return nodesWithTranslation
        .map(function (node) {
        var textNodes = xpath.select('//text()', node);
        if (textNodes.length > 1) {
            console.debug('More than one text node found');
        }
        return textNodes.length === 0 ? '' : textNodes.join(' ');
    })
        .join(' ');
};
/**
 * Common class for google translator implementations
 */
var AbstractGoogleTranslator = /** @class */ (function (_super) {
    __extends(AbstractGoogleTranslator, _super);
    function AbstractGoogleTranslator() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AbstractGoogleTranslator.isSupportedAutoFrom = function () {
        return true;
    };
    AbstractGoogleTranslator.getSupportedLanguages = function () {
        var reversedLanguagesMap = Object.fromEntries(Object.entries(fixedLanguagesMap).map(function (_a) {
            var _b = __read(_a, 2), key = _b[0], val = _b[1];
            return [val, key];
        }));
        return getLanguageCodesISO639v2(supportedLanguages.map(function (lang) {
            var _a;
            // Replace legacy language codes to actual
            return (_a = reversedLanguagesMap[lang]) !== null && _a !== void 0 ? _a : lang;
        }));
    };
    AbstractGoogleTranslator.prototype.getLengthLimit = function () {
        return 4000;
    };
    AbstractGoogleTranslator.prototype.getRequestsTimeout = function () {
        return 300;
    };
    /**
     * Map ISO lang codes to google translator lang codes
     */
    AbstractGoogleTranslator.prototype.getFixedLanguage = function (lang) {
        var _a;
        if (lang === 'zh')
            return 'zh-CN';
        return (_a = fixedLanguagesMap[lang]) !== null && _a !== void 0 ? _a : lang;
    };
    return AbstractGoogleTranslator;
}(BaseTranslator));
export { AbstractGoogleTranslator };
/**
 * Translator implementation which use Google API with token from https://translate.google.com
 */
var GoogleTranslator = /** @class */ (function (_super) {
    __extends(GoogleTranslator, _super);
    function GoogleTranslator() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    GoogleTranslator.prototype.checkLimitExceeding = function (text) {
        if (Array.isArray(text)) {
            var encodedText = this.encodeForBatch(text).join('');
            var extra = encodedText.length - this.getLengthLimit();
            return extra > 0 ? extra : 0;
        }
        else {
            var extra = text.length - this.getLengthLimit();
            return extra > 0 ? extra : 0;
        }
    };
    GoogleTranslator.prototype.translate = function (text, from, to) {
        var _this = this;
        return getToken(text).then(function (_a) {
            var tk = _a.value;
            var apiPath = 'https://translate.google.com/translate_a/single';
            var data = {
                client: 't',
                sl: _this.getFixedLanguage(from),
                tl: _this.getFixedLanguage(to),
                hl: _this.getFixedLanguage(to),
                dt: ['at', 'bd', 'ex', 'ld', 'md', 'qca', 'rw', 'rm', 'ss', 't'],
                ie: 'UTF-8',
                oe: 'UTF-8',
                otf: 1,
                ssel: 0,
                tsel: 0,
                kc: 7,
                q: text,
                tk: tk,
            };
            var url = apiPath + '?' + stringify(data);
            return axios
                .get(_this.wrapUrlToCorsProxy(url), {
                withCredentials: false,
                headers: _this.options.headers,
            })
                .then(function (rsp) { return rsp.data; })
                .then(function (rsp) {
                if (!(rsp instanceof Array) || !(rsp[0] instanceof Array)) {
                    throw new Error('Unexpected response');
                }
                var translatedText = rsp[0]
                    .map(function (chunk) {
                    return chunk instanceof Array && typeof chunk[0] === 'string'
                        ? chunk[0]
                        : '';
                })
                    .join('');
                return translatedText;
            });
        });
    };
    GoogleTranslator.prototype.translateBatch = function (text, from, to) {
        var _this = this;
        var preparedText = this.encodeForBatch(text);
        return getToken(preparedText.join('')).then(function (_a) {
            var tk = _a.value;
            var apiPath = 'https://translate.googleapis.com/translate_a/t';
            var data = {
                anno: 3,
                client: 'te',
                v: '1.0',
                format: 'html',
                sl: _this.getFixedLanguage(from),
                tl: _this.getFixedLanguage(to),
                tk: tk,
            };
            var url = apiPath + '?' + stringify(data);
            var body = preparedText
                .map(function (text) { return "&q=".concat(encodeURIComponent(text)); })
                .join('');
            return axios({
                url: _this.wrapUrlToCorsProxy(url),
                method: 'POST',
                withCredentials: false,
                headers: __assign({ 'Content-Type': 'application/x-www-form-urlencoded' }, _this.options.headers),
                data: body,
            })
                .then(function (rsp) { return rsp.data; })
                .then(function (rawResp) {
                try {
                    if (!Array.isArray(rawResp)) {
                        throw new Error('Unexpected response');
                    }
                    var isSingleResponseMode_1 = text.length === 1;
                    var result_1 = [];
                    visitArrayItems(rawResp, function (obj) {
                        if (isSingleResponseMode_1 && result_1.length === 1)
                            return;
                        if (typeof obj !== 'string')
                            return;
                        if (isSingleResponseMode_1) {
                            var parsedText = parseXMLResponse(obj);
                            result_1.push(parsedText || obj);
                        }
                        else {
                            var parsedText = parseXMLResponse(obj);
                            if (parsedText !== null) {
                                result_1.push(parsedText);
                            }
                        }
                    });
                    if (result_1.length !== text.length) {
                        throw new Error('Mismatching a lengths of original and translated arrays');
                    }
                    return result_1;
                }
                catch (err) {
                    console.warn('Got response', rawResp);
                    throw err;
                }
            });
        });
    };
    GoogleTranslator.prototype.encodeForBatch = function (textList) {
        return textList.map(function (text, i) { return "<pre><a i=\"".concat(i, "\">").concat(text, "</a></pre>"); });
    };
    GoogleTranslator.translatorName = 'GoogleTranslator';
    return GoogleTranslator;
}(AbstractGoogleTranslator));
export { GoogleTranslator };
/**
 * Translator implementation which use Google API without token
 */
var GoogleTranslatorTokenFree = /** @class */ (function (_super) {
    __extends(GoogleTranslatorTokenFree, _super);
    function GoogleTranslatorTokenFree() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.translate = function (text, from, to) { return __awaiter(_this, void 0, void 0, function () {
            var _a, translation;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.translateBatch([text], from, to)];
                    case 1:
                        _a = __read.apply(void 0, [_b.sent(), 1]), translation = _a[0];
                        return [2 /*return*/, translation];
                }
            });
        }); };
        return _this;
    }
    GoogleTranslatorTokenFree.prototype.translateBatch = function (text, from, to) {
        var apiPath = 'https://translate.googleapis.com/translate_a/t';
        var data = {
            client: 'dict-chrome-ex',
            sl: this.getFixedLanguage(from),
            tl: this.getFixedLanguage(to),
            q: text,
        };
        var url = apiPath + '?' + stringify(data);
        return axios({
            url: this.wrapUrlToCorsProxy(url),
            method: 'GET',
            withCredentials: false,
            headers: __assign({ 'Content-Type': 'application/x-www-form-urlencoded' }, this.options.headers),
        })
            .then(function (rsp) { return rsp.data; })
            .then(function (rawResp) {
            try {
                if (!Array.isArray(rawResp)) {
                    throw new Error('Unexpected response');
                }
                var intermediateTextsArray_1 = [];
                visitArrayItems(rawResp, function (obj) {
                    if (typeof obj === 'string') {
                        intermediateTextsArray_1.push(obj);
                    }
                });
                var result = [];
                var isSingleResponseMode = text.length === 1;
                var isOneToOneMappingMode = intermediateTextsArray_1.length === text.length;
                for (var idx in intermediateTextsArray_1) {
                    var text_1 = intermediateTextsArray_1[idx];
                    if (isSingleResponseMode) {
                        result.push(text_1);
                        break;
                    }
                    // Each second text it's not translation if not 1-1 mapping
                    var isTranslation = isOneToOneMappingMode || Number(idx) % 2 === 0;
                    if (isTranslation) {
                        result.push(text_1);
                    }
                }
                if (result.length !== text.length) {
                    console.warn('Translation result', result);
                    throw new Error('Mismatching a lengths of original and translated arrays');
                }
                return result;
            }
            catch (err) {
                console.warn('Got response', rawResp);
                throw err;
            }
        });
    };
    GoogleTranslatorTokenFree.translatorName = 'GoogleTranslatorTokenFree';
    return GoogleTranslatorTokenFree;
}(AbstractGoogleTranslator));
export { GoogleTranslatorTokenFree };

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zbGF0b3JzL0dvb2dsZVRyYW5zbGF0b3IvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQzFCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDekMsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQzFCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUczQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNuQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQzFDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRWhFOzs7Ozs7O0dBT0c7QUFDSCxJQUFNLGlCQUFpQixHQUEyQjtJQUNqRCxFQUFFLEVBQUUsSUFBSTtJQUNSLEVBQUUsRUFBRSxJQUFJO0NBQ1IsQ0FBQztBQUVGOztHQUVHO0FBQ0gsaUJBQWlCO0FBQ2pCLGtCQUFrQjtBQUNsQixNQUFNLENBQUMsSUFBTSxrQkFBa0IsR0FBRztJQUNqQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLO0lBQzNELElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7SUFDNUQsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtJQUMzRCxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJO0lBQzNELElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7SUFDNUQsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtJQUMzRCxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO0lBQzNELEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUk7SUFDbEUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtJQUMzRCxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO0lBQzFELElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7SUFDMUQsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtJQUMxRCxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO0lBQzFELE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSTtDQUN0QixDQUFDO0FBQ0YsZ0JBQWdCO0FBRWhCLElBQU0sZ0JBQWdCLEdBQUcsVUFBQyxJQUFZO0lBQ3JDLElBQUksR0FBYSxDQUFDO0lBQ2xCLElBQUk7UUFDSCxHQUFHLEdBQUcsSUFBSSxTQUFTLEVBQUUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDNUM7SUFBQyxPQUFPLEdBQUcsRUFBRTtRQUNiLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkIsT0FBTyxJQUFJLENBQUM7S0FDWjtJQUVELElBQU0sb0JBQW9CLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUV4RSxJQUFJLG9CQUFvQixDQUFDLE1BQU0sS0FBSyxDQUFDO1FBQUUsT0FBTyxJQUFJLENBQUM7SUFDbkQsT0FBTyxvQkFBb0I7U0FDekIsR0FBRyxDQUFDLFVBQUMsSUFBSTtRQUNULElBQU0sU0FBUyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLElBQVksQ0FBQyxDQUFDO1FBQ3pELElBQUksU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDekIsT0FBTyxDQUFDLEtBQUssQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1NBQy9DO1FBRUQsT0FBTyxTQUFTLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzFELENBQUMsQ0FBQztTQUNELElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNiLENBQUMsQ0FBQztBQUVGOztHQUVHO0FBQ0g7SUFBdUQsNENBQWM7SUFBckU7O0lBaUNBLENBQUM7SUFoQ2MsNENBQW1CLEdBQWpDO1FBQ0MsT0FBTyxJQUFJLENBQUM7SUFDYixDQUFDO0lBRWEsOENBQXFCLEdBQW5DO1FBQ0MsSUFBTSxvQkFBb0IsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUM5QyxNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUMsRUFBVTtnQkFBVixLQUFBLGFBQVUsRUFBVCxHQUFHLFFBQUEsRUFBRSxHQUFHLFFBQUE7WUFBTSxPQUFBLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQztRQUFWLENBQVUsQ0FBQyxDQUNqRSxDQUFDO1FBRUYsT0FBTyx3QkFBd0IsQ0FDOUIsa0JBQWtCLENBQUMsR0FBRyxDQUFDLFVBQUMsSUFBSTs7WUFDM0IsMENBQTBDO1lBQzFDLE9BQU8sTUFBQSxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsbUNBQUksSUFBSSxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUNGLENBQUM7SUFDSCxDQUFDO0lBRU0saURBQWMsR0FBckI7UUFDQyxPQUFPLElBQUksQ0FBQztJQUNiLENBQUM7SUFFTSxxREFBa0IsR0FBekI7UUFDQyxPQUFPLEdBQUcsQ0FBQztJQUNaLENBQUM7SUFFRDs7T0FFRztJQUNPLG1EQUFnQixHQUExQixVQUEyQixJQUFzQjs7UUFDaEQsSUFBSSxJQUFJLEtBQUssSUFBSTtZQUFFLE9BQU8sT0FBTyxDQUFDO1FBQ2xDLE9BQU8sTUFBQSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsbUNBQUksSUFBSSxDQUFDO0lBQ3hDLENBQUM7SUFDRiwrQkFBQztBQUFELENBakNBLEFBaUNDLENBakNzRCxjQUFjLEdBaUNwRTs7QUFFRDs7R0FFRztBQUNIO0lBQXNDLG9DQUF3QjtJQUE5RDs7SUFzSUEsQ0FBQztJQW5JTyw4Q0FBbUIsR0FBMUIsVUFBMkIsSUFBdUI7UUFDakQsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3hCLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3ZELElBQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3pELE9BQU8sS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDN0I7YUFBTTtZQUNOLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ2xELE9BQU8sS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDN0I7SUFDRixDQUFDO0lBRU0sb0NBQVMsR0FBaEIsVUFBaUIsSUFBWSxFQUFFLElBQXNCLEVBQUUsRUFBWTtRQUFuRSxpQkE0Q0M7UUEzQ0EsT0FBTyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsRUFBYTtnQkFBSixFQUFFLFdBQUE7WUFDdEMsSUFBTSxPQUFPLEdBQUcsaURBQWlELENBQUM7WUFFbEUsSUFBTSxJQUFJLEdBQUc7Z0JBQ1osTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsRUFBRSxFQUFFLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUM7Z0JBQy9CLEVBQUUsRUFBRSxLQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDO2dCQUM3QixFQUFFLEVBQUUsS0FBSSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQztnQkFDN0IsRUFBRSxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDO2dCQUNoRSxFQUFFLEVBQUUsT0FBTztnQkFDWCxFQUFFLEVBQUUsT0FBTztnQkFDWCxHQUFHLEVBQUUsQ0FBQztnQkFDTixJQUFJLEVBQUUsQ0FBQztnQkFDUCxJQUFJLEVBQUUsQ0FBQztnQkFDUCxFQUFFLEVBQUUsQ0FBQztnQkFDTCxDQUFDLEVBQUUsSUFBSTtnQkFDUCxFQUFFLElBQUE7YUFDRixDQUFDO1lBRUYsSUFBTSxHQUFHLEdBQUcsT0FBTyxHQUFHLEdBQUcsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFNUMsT0FBTyxLQUFLO2lCQUNWLEdBQUcsQ0FBQyxLQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQ2xDLGVBQWUsRUFBRSxLQUFLO2dCQUN0QixPQUFPLEVBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPO2FBQzdCLENBQUM7aUJBQ0QsSUFBSSxDQUFDLFVBQUMsR0FBRyxJQUFLLE9BQUEsR0FBRyxDQUFDLElBQUksRUFBUixDQUFRLENBQUM7aUJBQ3ZCLElBQUksQ0FBQyxVQUFDLEdBQUc7Z0JBQ1QsSUFBSSxDQUFDLENBQUMsR0FBRyxZQUFZLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFlBQVksS0FBSyxDQUFDLEVBQUU7b0JBQzFELE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQztpQkFDdkM7Z0JBRUQsSUFBTSxjQUFjLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztxQkFDM0IsR0FBRyxDQUFDLFVBQUMsS0FBSztvQkFDVixPQUFBLEtBQUssWUFBWSxLQUFLLElBQUksT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssUUFBUTt3QkFDckQsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7d0JBQ1YsQ0FBQyxDQUFDLEVBQUU7Z0JBRkwsQ0FFSyxDQUNMO3FCQUNBLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFFWCxPQUFPLGNBQWMsQ0FBQztZQUN2QixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVNLHlDQUFjLEdBQXJCLFVBQXNCLElBQWMsRUFBRSxJQUFzQixFQUFFLEVBQVk7UUFBMUUsaUJBcUVDO1FBcEVBLElBQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0MsT0FBTyxRQUFRLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLEVBQWE7Z0JBQUosRUFBRSxXQUFBO1lBQ3ZELElBQU0sT0FBTyxHQUFHLGdEQUFnRCxDQUFDO1lBRWpFLElBQU0sSUFBSSxHQUFHO2dCQUNaLElBQUksRUFBRSxDQUFDO2dCQUNQLE1BQU0sRUFBRSxJQUFJO2dCQUNaLENBQUMsRUFBRSxLQUFLO2dCQUNSLE1BQU0sRUFBRSxNQUFNO2dCQUNkLEVBQUUsRUFBRSxLQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDO2dCQUMvQixFQUFFLEVBQUUsS0FBSSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQztnQkFDN0IsRUFBRSxJQUFBO2FBQ0YsQ0FBQztZQUVGLElBQU0sR0FBRyxHQUFHLE9BQU8sR0FBRyxHQUFHLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVDLElBQU0sSUFBSSxHQUFHLFlBQVk7aUJBQ3ZCLEdBQUcsQ0FBQyxVQUFDLElBQUksSUFBSyxPQUFBLGFBQU0sa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUUsRUFBaEMsQ0FBZ0MsQ0FBQztpQkFDL0MsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRVgsT0FBTyxLQUFLLENBQUM7Z0JBQ1osR0FBRyxFQUFFLEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLENBQUM7Z0JBQ2pDLE1BQU0sRUFBRSxNQUFNO2dCQUNkLGVBQWUsRUFBRSxLQUFLO2dCQUN0QixPQUFPLGFBQ04sY0FBYyxFQUFFLG1DQUFtQyxJQUNoRCxLQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FDdkI7Z0JBQ0QsSUFBSSxFQUFFLElBQUk7YUFDVixDQUFDO2lCQUNBLElBQUksQ0FBQyxVQUFDLEdBQUcsSUFBSyxPQUFBLEdBQUcsQ0FBQyxJQUFJLEVBQVIsQ0FBUSxDQUFDO2lCQUN2QixJQUFJLENBQUMsVUFBQyxPQUFPO2dCQUNiLElBQUk7b0JBQ0gsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7d0JBQzVCLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQztxQkFDdkM7b0JBRUQsSUFBTSxzQkFBb0IsR0FBRyxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztvQkFFL0MsSUFBTSxRQUFNLEdBQWEsRUFBRSxDQUFDO29CQUM1QixlQUFlLENBQUMsT0FBTyxFQUFFLFVBQUMsR0FBRzt3QkFDNUIsSUFBSSxzQkFBb0IsSUFBSSxRQUFNLENBQUMsTUFBTSxLQUFLLENBQUM7NEJBQUUsT0FBTzt3QkFFeEQsSUFBSSxPQUFPLEdBQUcsS0FBSyxRQUFROzRCQUFFLE9BQU87d0JBRXBDLElBQUksc0JBQW9CLEVBQUU7NEJBQ3pCLElBQU0sVUFBVSxHQUFHLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxDQUFDOzRCQUN6QyxRQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxHQUFHLENBQUMsQ0FBQzt5QkFDL0I7NkJBQU07NEJBQ04sSUFBTSxVQUFVLEdBQUcsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUM7NEJBQ3pDLElBQUksVUFBVSxLQUFLLElBQUksRUFBRTtnQ0FDeEIsUUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQzs2QkFDeEI7eUJBQ0Q7b0JBQ0YsQ0FBQyxDQUFDLENBQUM7b0JBRUgsSUFBSSxRQUFNLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNLEVBQUU7d0JBQ2xDLE1BQU0sSUFBSSxLQUFLLENBQ2QseURBQXlELENBQ3pELENBQUM7cUJBQ0Y7b0JBRUQsT0FBTyxRQUFrQixDQUFDO2lCQUMxQjtnQkFBQyxPQUFPLEdBQUcsRUFBRTtvQkFDYixPQUFPLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsQ0FBQztvQkFDdEMsTUFBTSxHQUFHLENBQUM7aUJBQ1Y7WUFDRixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVPLHlDQUFjLEdBQXRCLFVBQXVCLFFBQWtCO1FBQ3hDLE9BQU8sUUFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksRUFBRSxDQUFDLElBQUssT0FBQSxzQkFBYyxDQUFDLGdCQUFLLElBQUksZUFBWSxFQUFwQyxDQUFvQyxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQXBJc0IsK0JBQWMsR0FBRyxrQkFBa0IsQ0FBQztJQXFJNUQsdUJBQUM7Q0F0SUQsQUFzSUMsQ0F0SXFDLHdCQUF3QixHQXNJN0Q7U0F0SVksZ0JBQWdCO0FBd0k3Qjs7R0FFRztBQUNIO0lBQStDLDZDQUF3QjtJQUF2RTtRQUFBLHFFQThFQztRQTNFTyxlQUFTLEdBQUcsVUFBTyxJQUFZLEVBQUUsSUFBc0IsRUFBRSxFQUFZOzs7OzRCQUNyRCxxQkFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxFQUFBOzt3QkFBM0QsS0FBQSxzQkFBZ0IsU0FBMkMsS0FBQSxFQUExRCxXQUFXLFFBQUE7d0JBQ2xCLHNCQUFPLFdBQVcsRUFBQzs7O2FBQ25CLENBQUM7O0lBd0VILENBQUM7SUF0RU8sa0RBQWMsR0FBckIsVUFBc0IsSUFBYyxFQUFFLElBQXNCLEVBQUUsRUFBWTtRQUN6RSxJQUFNLE9BQU8sR0FBRyxnREFBZ0QsQ0FBQztRQUVqRSxJQUFNLElBQUksR0FBRztZQUNaLE1BQU0sRUFBRSxnQkFBZ0I7WUFDeEIsRUFBRSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUM7WUFDL0IsRUFBRSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUM7WUFDN0IsQ0FBQyxFQUFFLElBQUk7U0FDUCxDQUFDO1FBRUYsSUFBTSxHQUFHLEdBQUcsT0FBTyxHQUFHLEdBQUcsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFNUMsT0FBTyxLQUFLLENBQUM7WUFDWixHQUFHLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQztZQUNqQyxNQUFNLEVBQUUsS0FBSztZQUNiLGVBQWUsRUFBRSxLQUFLO1lBQ3RCLE9BQU8sYUFDTixjQUFjLEVBQUUsbUNBQW1DLElBQ2hELElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUN2QjtTQUNELENBQUM7YUFDQSxJQUFJLENBQUMsVUFBQyxHQUFHLElBQUssT0FBQSxHQUFHLENBQUMsSUFBSSxFQUFSLENBQVEsQ0FBQzthQUN2QixJQUFJLENBQUMsVUFBQyxPQUFPO1lBQ2IsSUFBSTtnQkFDSCxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtvQkFDNUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO2lCQUN2QztnQkFFRCxJQUFNLHdCQUFzQixHQUFhLEVBQUUsQ0FBQztnQkFDNUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxVQUFDLEdBQUc7b0JBQzVCLElBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxFQUFFO3dCQUM1Qix3QkFBc0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7cUJBQ2pDO2dCQUNGLENBQUMsQ0FBQyxDQUFDO2dCQUVILElBQU0sTUFBTSxHQUFhLEVBQUUsQ0FBQztnQkFFNUIsSUFBTSxvQkFBb0IsR0FBRyxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztnQkFDL0MsSUFBTSxxQkFBcUIsR0FDMUIsd0JBQXNCLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNLENBQUM7Z0JBQy9DLEtBQUssSUFBTSxHQUFHLElBQUksd0JBQXNCLEVBQUU7b0JBQ3pDLElBQU0sTUFBSSxHQUFHLHdCQUFzQixDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUV6QyxJQUFJLG9CQUFvQixFQUFFO3dCQUN6QixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQUksQ0FBQyxDQUFDO3dCQUNsQixNQUFNO3FCQUNOO29CQUVELDJEQUEyRDtvQkFDM0QsSUFBTSxhQUFhLEdBQ2xCLHFCQUFxQixJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNoRCxJQUFJLGFBQWEsRUFBRTt3QkFDbEIsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFJLENBQUMsQ0FBQztxQkFDbEI7aUJBQ0Q7Z0JBRUQsSUFBSSxNQUFNLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNLEVBQUU7b0JBQ2xDLE9BQU8sQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsTUFBTSxDQUFDLENBQUM7b0JBQzNDLE1BQU0sSUFBSSxLQUFLLENBQ2QseURBQXlELENBQ3pELENBQUM7aUJBQ0Y7Z0JBRUQsT0FBTyxNQUFrQixDQUFDO2FBQzFCO1lBQUMsT0FBTyxHQUFHLEVBQUU7Z0JBQ2IsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQ3RDLE1BQU0sR0FBRyxDQUFDO2FBQ1Y7UUFDRixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUE1RXNCLHdDQUFjLEdBQUcsMkJBQTJCLENBQUM7SUE2RXJFLGdDQUFDO0NBOUVELEFBOEVDLENBOUU4Qyx3QkFBd0IsR0E4RXRFO1NBOUVZLHlCQUF5QiIsImZpbGUiOiJ0cmFuc2xhdG9ycy9Hb29nbGVUcmFuc2xhdG9yL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCB7IHN0cmluZ2lmeSB9IGZyb20gJ3F1ZXJ5LXN0cmluZyc7XG5pbXBvcnQgeHBhdGggZnJvbSAneHBhdGgnO1xuaW1wb3J0IHsgRE9NUGFyc2VyIH0gZnJvbSAnQHhtbGRvbS94bWxkb20nO1xuXG5pbXBvcnQgeyBsYW5nQ29kZSwgbGFuZ0NvZGVXaXRoQXV0byB9IGZyb20gJy4uLy4uL3R5cGVzL1RyYW5zbGF0b3InO1xuaW1wb3J0IHsgQmFzZVRyYW5zbGF0b3IgfSBmcm9tICcuLi8uLi91dGlsL0Jhc2VUcmFuc2xhdG9yJztcbmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAnLi90b2tlbic7XG5pbXBvcnQgeyB2aXNpdEFycmF5SXRlbXMgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IGdldExhbmd1YWdlQ29kZXNJU082Mzl2MiB9IGZyb20gJy4uLy4uL3V0aWwvbGFuZ3VhZ2VzJztcblxuLyoqXG4gKiBNYXAgd2l0aCBsYW5ndWFnZXMgYWxpYXNlcy5cbiAqXG4gKiBHb29nbGUgdHJhbnNsYXRvciB1c2UgbGVnYWN5IGNvZGVzIGZvciBzb21lIGxhbmd1YWdlcyxcbiAqIHRoaXMgbWFwIHVzZWZ1bCB0byB1c2UgYWN0dWFsIGxhbmd1YWdlIGNvZGVzIGJ5IGFsaWFzZXNcbiAqXG4gKiBAbGluayBodHRwczovL3htbC5jb3ZlcnBhZ2VzLm9yZy9pc282MzlhLmh0bWxcbiAqL1xuY29uc3QgZml4ZWRMYW5ndWFnZXNNYXA6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG5cdGhlOiAnaXcnLFxuXHRqdjogJ2p3Jyxcbn07XG5cbi8qKlxuICogUmF3IGxhbmd1YWdlcyBhcnJheVxuICovXG4vLyBlc2xpbnQtZGlzYWJsZVxuLy8gcHJldHRpZXItaWdub3JlXG5leHBvcnQgY29uc3Qgc3VwcG9ydGVkTGFuZ3VhZ2VzID0gW1xuXHQnYWYnLCAnYWsnLCAnYW0nLCAnYXInLCAnYXMnLCAnYXknLCAnYXonLCAnYmUnLCAnYmcnLCAnYmhvJyxcblx0J2JtJywgJ2JuJywgJ2JzJywgJ2NhJywgJ2NlYicsICdja2InLCAnY28nLCAnY3MnLCAnY3knLCAnZGEnLFxuXHQnZGUnLCAnZG9pJywgJ2R2JywgJ2VlJywgJ2VsJywgJ2VuJywgJ2VvJywgJ2VzJywgJ2V0JywgJ2V1Jyxcblx0J2ZhJywgJ2ZpJywgJ2ZyJywgJ2Z5JywgJ2dhJywgJ2dkJywgJ2dsJywgJ2duJywgJ2dvbScsICdndScsXG5cdCdoYScsICdoYXcnLCAnaGknLCAnaG1uJywgJ2hyJywgJ2h0JywgJ2h1JywgJ2h5JywgJ2lkJywgJ2lnJyxcblx0J2lsbycsICdpcycsICdpdCcsICdpdycsICdqYScsICdqdycsICdrYScsICdraycsICdrbScsICdrbicsXG5cdCdrbycsICdrcmknLCAna3UnLCAna3knLCAnbGEnLCAnbGInLCAnbGcnLCAnbG4nLCAnbG8nLCAnbHQnLFxuXHQnbHVzJywgJ2x2JywgJ21haScsICdtZycsICdtaScsICdtaycsICdtbCcsICdtbicsICdtbmktTXRlaScsICdtcicsXG5cdCdtcycsICdtdCcsICdteScsICduZScsICdubCcsICdubycsICduc28nLCAnbnknLCAnb20nLCAnb3InLFxuXHQncGEnLCAncGwnLCAncHMnLCAncHQnLCAncXUnLCAncm8nLCAncnUnLCAncncnLCAnc2EnLCAnc2QnLFxuXHQnc2knLCAnc2snLCAnc2wnLCAnc20nLCAnc24nLCAnc28nLCAnc3EnLCAnc3InLCAnc3QnLCAnc3UnLFxuXHQnc3YnLCAnc3cnLCAndGEnLCAndGUnLCAndGcnLCAndGgnLCAndGknLCAndGsnLCAndGwnLCAndHInLFxuXHQndHMnLCAndHQnLCAndWcnLCAndWsnLCAndXInLCAndXonLCAndmknLCAneGgnLCAneWknLCAneW8nLFxuXHQnemgtQ04nLCAnemgtVFcnLCAnenUnXG5dO1xuLy8gZXNsaW50LWVuYWJsZVxuXG5jb25zdCBwYXJzZVhNTFJlc3BvbnNlID0gKHRleHQ6IHN0cmluZykgPT4ge1xuXHRsZXQgZG9jOiBEb2N1bWVudDtcblx0dHJ5IHtcblx0XHRkb2MgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKHRleHQpO1xuXHR9IGNhdGNoIChlcnIpIHtcblx0XHRjb25zb2xlLmVycm9yKGVycik7XG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRjb25zdCBub2Rlc1dpdGhUcmFuc2xhdGlvbiA9IHhwYXRoLnNlbGVjdCgnLy9wcmUvKltub3Qoc2VsZjo6aSldJywgZG9jKTtcblxuXHRpZiAobm9kZXNXaXRoVHJhbnNsYXRpb24ubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDtcblx0cmV0dXJuIG5vZGVzV2l0aFRyYW5zbGF0aW9uXG5cdFx0Lm1hcCgobm9kZSkgPT4ge1xuXHRcdFx0Y29uc3QgdGV4dE5vZGVzID0geHBhdGguc2VsZWN0KCcvL3RleHQoKScsIG5vZGUgYXMgTm9kZSk7XG5cdFx0XHRpZiAodGV4dE5vZGVzLmxlbmd0aCA+IDEpIHtcblx0XHRcdFx0Y29uc29sZS5kZWJ1ZygnTW9yZSB0aGFuIG9uZSB0ZXh0IG5vZGUgZm91bmQnKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRleHROb2Rlcy5sZW5ndGggPT09IDAgPyAnJyA6IHRleHROb2Rlcy5qb2luKCcgJyk7XG5cdFx0fSlcblx0XHQuam9pbignICcpO1xufTtcblxuLyoqXG4gKiBDb21tb24gY2xhc3MgZm9yIGdvb2dsZSB0cmFuc2xhdG9yIGltcGxlbWVudGF0aW9uc1xuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RHb29nbGVUcmFuc2xhdG9yIGV4dGVuZHMgQmFzZVRyYW5zbGF0b3Ige1xuXHRwdWJsaWMgc3RhdGljIGlzU3VwcG9ydGVkQXV0b0Zyb20oKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRwdWJsaWMgc3RhdGljIGdldFN1cHBvcnRlZExhbmd1YWdlcygpOiBsYW5nQ29kZVtdIHtcblx0XHRjb25zdCByZXZlcnNlZExhbmd1YWdlc01hcCA9IE9iamVjdC5mcm9tRW50cmllcyhcblx0XHRcdE9iamVjdC5lbnRyaWVzKGZpeGVkTGFuZ3VhZ2VzTWFwKS5tYXAoKFtrZXksIHZhbF0pID0+IFt2YWwsIGtleV0pLFxuXHRcdCk7XG5cblx0XHRyZXR1cm4gZ2V0TGFuZ3VhZ2VDb2Rlc0lTTzYzOXYyKFxuXHRcdFx0c3VwcG9ydGVkTGFuZ3VhZ2VzLm1hcCgobGFuZykgPT4ge1xuXHRcdFx0XHQvLyBSZXBsYWNlIGxlZ2FjeSBsYW5ndWFnZSBjb2RlcyB0byBhY3R1YWxcblx0XHRcdFx0cmV0dXJuIHJldmVyc2VkTGFuZ3VhZ2VzTWFwW2xhbmddID8/IGxhbmc7XG5cdFx0XHR9KSxcblx0XHQpO1xuXHR9XG5cblx0cHVibGljIGdldExlbmd0aExpbWl0KCkge1xuXHRcdHJldHVybiA0MDAwO1xuXHR9XG5cblx0cHVibGljIGdldFJlcXVlc3RzVGltZW91dCgpIHtcblx0XHRyZXR1cm4gMzAwO1xuXHR9XG5cblx0LyoqXG5cdCAqIE1hcCBJU08gbGFuZyBjb2RlcyB0byBnb29nbGUgdHJhbnNsYXRvciBsYW5nIGNvZGVzXG5cdCAqL1xuXHRwcm90ZWN0ZWQgZ2V0Rml4ZWRMYW5ndWFnZShsYW5nOiBsYW5nQ29kZVdpdGhBdXRvKSB7XG5cdFx0aWYgKGxhbmcgPT09ICd6aCcpIHJldHVybiAnemgtQ04nO1xuXHRcdHJldHVybiBmaXhlZExhbmd1YWdlc01hcFtsYW5nXSA/PyBsYW5nO1xuXHR9XG59XG5cbi8qKlxuICogVHJhbnNsYXRvciBpbXBsZW1lbnRhdGlvbiB3aGljaCB1c2UgR29vZ2xlIEFQSSB3aXRoIHRva2VuIGZyb20gaHR0cHM6Ly90cmFuc2xhdGUuZ29vZ2xlLmNvbVxuICovXG5leHBvcnQgY2xhc3MgR29vZ2xlVHJhbnNsYXRvciBleHRlbmRzIEFic3RyYWN0R29vZ2xlVHJhbnNsYXRvciB7XG5cdHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgdHJhbnNsYXRvck5hbWUgPSAnR29vZ2xlVHJhbnNsYXRvcic7XG5cblx0cHVibGljIGNoZWNrTGltaXRFeGNlZWRpbmcodGV4dDogc3RyaW5nIHwgc3RyaW5nW10pIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheSh0ZXh0KSkge1xuXHRcdFx0Y29uc3QgZW5jb2RlZFRleHQgPSB0aGlzLmVuY29kZUZvckJhdGNoKHRleHQpLmpvaW4oJycpO1xuXHRcdFx0Y29uc3QgZXh0cmEgPSBlbmNvZGVkVGV4dC5sZW5ndGggLSB0aGlzLmdldExlbmd0aExpbWl0KCk7XG5cdFx0XHRyZXR1cm4gZXh0cmEgPiAwID8gZXh0cmEgOiAwO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zdCBleHRyYSA9IHRleHQubGVuZ3RoIC0gdGhpcy5nZXRMZW5ndGhMaW1pdCgpO1xuXHRcdFx0cmV0dXJuIGV4dHJhID4gMCA/IGV4dHJhIDogMDtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgdHJhbnNsYXRlKHRleHQ6IHN0cmluZywgZnJvbTogbGFuZ0NvZGVXaXRoQXV0bywgdG86IGxhbmdDb2RlKSB7XG5cdFx0cmV0dXJuIGdldFRva2VuKHRleHQpLnRoZW4oKHsgdmFsdWU6IHRrIH0pID0+IHtcblx0XHRcdGNvbnN0IGFwaVBhdGggPSAnaHR0cHM6Ly90cmFuc2xhdGUuZ29vZ2xlLmNvbS90cmFuc2xhdGVfYS9zaW5nbGUnO1xuXG5cdFx0XHRjb25zdCBkYXRhID0ge1xuXHRcdFx0XHRjbGllbnQ6ICd0Jyxcblx0XHRcdFx0c2w6IHRoaXMuZ2V0Rml4ZWRMYW5ndWFnZShmcm9tKSxcblx0XHRcdFx0dGw6IHRoaXMuZ2V0Rml4ZWRMYW5ndWFnZSh0byksXG5cdFx0XHRcdGhsOiB0aGlzLmdldEZpeGVkTGFuZ3VhZ2UodG8pLFxuXHRcdFx0XHRkdDogWydhdCcsICdiZCcsICdleCcsICdsZCcsICdtZCcsICdxY2EnLCAncncnLCAncm0nLCAnc3MnLCAndCddLFxuXHRcdFx0XHRpZTogJ1VURi04Jyxcblx0XHRcdFx0b2U6ICdVVEYtOCcsXG5cdFx0XHRcdG90ZjogMSxcblx0XHRcdFx0c3NlbDogMCxcblx0XHRcdFx0dHNlbDogMCxcblx0XHRcdFx0a2M6IDcsXG5cdFx0XHRcdHE6IHRleHQsXG5cdFx0XHRcdHRrLFxuXHRcdFx0fTtcblxuXHRcdFx0Y29uc3QgdXJsID0gYXBpUGF0aCArICc/JyArIHN0cmluZ2lmeShkYXRhKTtcblxuXHRcdFx0cmV0dXJuIGF4aW9zXG5cdFx0XHRcdC5nZXQodGhpcy53cmFwVXJsVG9Db3JzUHJveHkodXJsKSwge1xuXHRcdFx0XHRcdHdpdGhDcmVkZW50aWFsczogZmFsc2UsXG5cdFx0XHRcdFx0aGVhZGVyczogdGhpcy5vcHRpb25zLmhlYWRlcnMsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC50aGVuKChyc3ApID0+IHJzcC5kYXRhKVxuXHRcdFx0XHQudGhlbigocnNwKSA9PiB7XG5cdFx0XHRcdFx0aWYgKCEocnNwIGluc3RhbmNlb2YgQXJyYXkpIHx8ICEocnNwWzBdIGluc3RhbmNlb2YgQXJyYXkpKSB7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgcmVzcG9uc2UnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjb25zdCB0cmFuc2xhdGVkVGV4dCA9IHJzcFswXVxuXHRcdFx0XHRcdFx0Lm1hcCgoY2h1bmspID0+XG5cdFx0XHRcdFx0XHRcdGNodW5rIGluc3RhbmNlb2YgQXJyYXkgJiYgdHlwZW9mIGNodW5rWzBdID09PSAnc3RyaW5nJ1xuXHRcdFx0XHRcdFx0XHRcdD8gY2h1bmtbMF1cblx0XHRcdFx0XHRcdFx0XHQ6ICcnLFxuXHRcdFx0XHRcdFx0KVxuXHRcdFx0XHRcdFx0LmpvaW4oJycpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHRyYW5zbGF0ZWRUZXh0O1xuXHRcdFx0XHR9KTtcblx0XHR9KTtcblx0fVxuXG5cdHB1YmxpYyB0cmFuc2xhdGVCYXRjaCh0ZXh0OiBzdHJpbmdbXSwgZnJvbTogbGFuZ0NvZGVXaXRoQXV0bywgdG86IGxhbmdDb2RlKSB7XG5cdFx0Y29uc3QgcHJlcGFyZWRUZXh0ID0gdGhpcy5lbmNvZGVGb3JCYXRjaCh0ZXh0KTtcblx0XHRyZXR1cm4gZ2V0VG9rZW4ocHJlcGFyZWRUZXh0LmpvaW4oJycpKS50aGVuKCh7IHZhbHVlOiB0ayB9KSA9PiB7XG5cdFx0XHRjb25zdCBhcGlQYXRoID0gJ2h0dHBzOi8vdHJhbnNsYXRlLmdvb2dsZWFwaXMuY29tL3RyYW5zbGF0ZV9hL3QnO1xuXG5cdFx0XHRjb25zdCBkYXRhID0ge1xuXHRcdFx0XHRhbm5vOiAzLFxuXHRcdFx0XHRjbGllbnQ6ICd0ZScsXG5cdFx0XHRcdHY6ICcxLjAnLFxuXHRcdFx0XHRmb3JtYXQ6ICdodG1sJyxcblx0XHRcdFx0c2w6IHRoaXMuZ2V0Rml4ZWRMYW5ndWFnZShmcm9tKSxcblx0XHRcdFx0dGw6IHRoaXMuZ2V0Rml4ZWRMYW5ndWFnZSh0byksXG5cdFx0XHRcdHRrLFxuXHRcdFx0fTtcblxuXHRcdFx0Y29uc3QgdXJsID0gYXBpUGF0aCArICc/JyArIHN0cmluZ2lmeShkYXRhKTtcblx0XHRcdGNvbnN0IGJvZHkgPSBwcmVwYXJlZFRleHRcblx0XHRcdFx0Lm1hcCgodGV4dCkgPT4gYCZxPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHRleHQpfWApXG5cdFx0XHRcdC5qb2luKCcnKTtcblxuXHRcdFx0cmV0dXJuIGF4aW9zKHtcblx0XHRcdFx0dXJsOiB0aGlzLndyYXBVcmxUb0NvcnNQcm94eSh1cmwpLFxuXHRcdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0d2l0aENyZWRlbnRpYWxzOiBmYWxzZSxcblx0XHRcdFx0aGVhZGVyczoge1xuXHRcdFx0XHRcdCdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcblx0XHRcdFx0XHQuLi50aGlzLm9wdGlvbnMuaGVhZGVycyxcblx0XHRcdFx0fSxcblx0XHRcdFx0ZGF0YTogYm9keSxcblx0XHRcdH0pXG5cdFx0XHRcdC50aGVuKChyc3ApID0+IHJzcC5kYXRhKVxuXHRcdFx0XHQudGhlbigocmF3UmVzcCkgPT4ge1xuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRpZiAoIUFycmF5LmlzQXJyYXkocmF3UmVzcCkpIHtcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdGVkIHJlc3BvbnNlJyk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGNvbnN0IGlzU2luZ2xlUmVzcG9uc2VNb2RlID0gdGV4dC5sZW5ndGggPT09IDE7XG5cblx0XHRcdFx0XHRcdGNvbnN0IHJlc3VsdDogc3RyaW5nW10gPSBbXTtcblx0XHRcdFx0XHRcdHZpc2l0QXJyYXlJdGVtcyhyYXdSZXNwLCAob2JqKSA9PiB7XG5cdFx0XHRcdFx0XHRcdGlmIChpc1NpbmdsZVJlc3BvbnNlTW9kZSAmJiByZXN1bHQubGVuZ3RoID09PSAxKSByZXR1cm47XG5cblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBvYmogIT09ICdzdHJpbmcnKSByZXR1cm47XG5cblx0XHRcdFx0XHRcdFx0aWYgKGlzU2luZ2xlUmVzcG9uc2VNb2RlKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y29uc3QgcGFyc2VkVGV4dCA9IHBhcnNlWE1MUmVzcG9uc2Uob2JqKTtcblx0XHRcdFx0XHRcdFx0XHRyZXN1bHQucHVzaChwYXJzZWRUZXh0IHx8IG9iaik7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0Y29uc3QgcGFyc2VkVGV4dCA9IHBhcnNlWE1MUmVzcG9uc2Uob2JqKTtcblx0XHRcdFx0XHRcdFx0XHRpZiAocGFyc2VkVGV4dCAhPT0gbnVsbCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmVzdWx0LnB1c2gocGFyc2VkVGV4dCk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0aWYgKHJlc3VsdC5sZW5ndGggIT09IHRleHQubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0XHRcdFx0XHQnTWlzbWF0Y2hpbmcgYSBsZW5ndGhzIG9mIG9yaWdpbmFsIGFuZCB0cmFuc2xhdGVkIGFycmF5cycsXG5cdFx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiByZXN1bHQgYXMgc3RyaW5nW107XG5cdFx0XHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oJ0dvdCByZXNwb25zZScsIHJhd1Jlc3ApO1xuXHRcdFx0XHRcdFx0dGhyb3cgZXJyO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0fSk7XG5cdH1cblxuXHRwcml2YXRlIGVuY29kZUZvckJhdGNoKHRleHRMaXN0OiBzdHJpbmdbXSkge1xuXHRcdHJldHVybiB0ZXh0TGlzdC5tYXAoKHRleHQsIGkpID0+IGA8cHJlPjxhIGk9XCIke2l9XCI+JHt0ZXh0fTwvYT48L3ByZT5gKTtcblx0fVxufVxuXG4vKipcbiAqIFRyYW5zbGF0b3IgaW1wbGVtZW50YXRpb24gd2hpY2ggdXNlIEdvb2dsZSBBUEkgd2l0aG91dCB0b2tlblxuICovXG5leHBvcnQgY2xhc3MgR29vZ2xlVHJhbnNsYXRvclRva2VuRnJlZSBleHRlbmRzIEFic3RyYWN0R29vZ2xlVHJhbnNsYXRvciB7XG5cdHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgdHJhbnNsYXRvck5hbWUgPSAnR29vZ2xlVHJhbnNsYXRvclRva2VuRnJlZSc7XG5cblx0cHVibGljIHRyYW5zbGF0ZSA9IGFzeW5jICh0ZXh0OiBzdHJpbmcsIGZyb206IGxhbmdDb2RlV2l0aEF1dG8sIHRvOiBsYW5nQ29kZSkgPT4ge1xuXHRcdGNvbnN0IFt0cmFuc2xhdGlvbl0gPSBhd2FpdCB0aGlzLnRyYW5zbGF0ZUJhdGNoKFt0ZXh0XSwgZnJvbSwgdG8pO1xuXHRcdHJldHVybiB0cmFuc2xhdGlvbjtcblx0fTtcblxuXHRwdWJsaWMgdHJhbnNsYXRlQmF0Y2godGV4dDogc3RyaW5nW10sIGZyb206IGxhbmdDb2RlV2l0aEF1dG8sIHRvOiBsYW5nQ29kZSkge1xuXHRcdGNvbnN0IGFwaVBhdGggPSAnaHR0cHM6Ly90cmFuc2xhdGUuZ29vZ2xlYXBpcy5jb20vdHJhbnNsYXRlX2EvdCc7XG5cblx0XHRjb25zdCBkYXRhID0ge1xuXHRcdFx0Y2xpZW50OiAnZGljdC1jaHJvbWUtZXgnLFxuXHRcdFx0c2w6IHRoaXMuZ2V0Rml4ZWRMYW5ndWFnZShmcm9tKSxcblx0XHRcdHRsOiB0aGlzLmdldEZpeGVkTGFuZ3VhZ2UodG8pLFxuXHRcdFx0cTogdGV4dCxcblx0XHR9O1xuXG5cdFx0Y29uc3QgdXJsID0gYXBpUGF0aCArICc/JyArIHN0cmluZ2lmeShkYXRhKTtcblxuXHRcdHJldHVybiBheGlvcyh7XG5cdFx0XHR1cmw6IHRoaXMud3JhcFVybFRvQ29yc1Byb3h5KHVybCksXG5cdFx0XHRtZXRob2Q6ICdHRVQnLFxuXHRcdFx0d2l0aENyZWRlbnRpYWxzOiBmYWxzZSxcblx0XHRcdGhlYWRlcnM6IHtcblx0XHRcdFx0J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuXHRcdFx0XHQuLi50aGlzLm9wdGlvbnMuaGVhZGVycyxcblx0XHRcdH0sXG5cdFx0fSlcblx0XHRcdC50aGVuKChyc3ApID0+IHJzcC5kYXRhKVxuXHRcdFx0LnRoZW4oKHJhd1Jlc3ApID0+IHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRpZiAoIUFycmF5LmlzQXJyYXkocmF3UmVzcCkpIHtcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCByZXNwb25zZScpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGNvbnN0IGludGVybWVkaWF0ZVRleHRzQXJyYXk6IHN0cmluZ1tdID0gW107XG5cdFx0XHRcdFx0dmlzaXRBcnJheUl0ZW1zKHJhd1Jlc3AsIChvYmopID0+IHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Ygb2JqID09PSAnc3RyaW5nJykge1xuXHRcdFx0XHRcdFx0XHRpbnRlcm1lZGlhdGVUZXh0c0FycmF5LnB1c2gob2JqKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGNvbnN0IHJlc3VsdDogc3RyaW5nW10gPSBbXTtcblxuXHRcdFx0XHRcdGNvbnN0IGlzU2luZ2xlUmVzcG9uc2VNb2RlID0gdGV4dC5sZW5ndGggPT09IDE7XG5cdFx0XHRcdFx0Y29uc3QgaXNPbmVUb09uZU1hcHBpbmdNb2RlID1cblx0XHRcdFx0XHRcdGludGVybWVkaWF0ZVRleHRzQXJyYXkubGVuZ3RoID09PSB0ZXh0Lmxlbmd0aDtcblx0XHRcdFx0XHRmb3IgKGNvbnN0IGlkeCBpbiBpbnRlcm1lZGlhdGVUZXh0c0FycmF5KSB7XG5cdFx0XHRcdFx0XHRjb25zdCB0ZXh0ID0gaW50ZXJtZWRpYXRlVGV4dHNBcnJheVtpZHhdO1xuXG5cdFx0XHRcdFx0XHRpZiAoaXNTaW5nbGVSZXNwb25zZU1vZGUpIHtcblx0XHRcdFx0XHRcdFx0cmVzdWx0LnB1c2godGV4dCk7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBFYWNoIHNlY29uZCB0ZXh0IGl0J3Mgbm90IHRyYW5zbGF0aW9uIGlmIG5vdCAxLTEgbWFwcGluZ1xuXHRcdFx0XHRcdFx0Y29uc3QgaXNUcmFuc2xhdGlvbiA9XG5cdFx0XHRcdFx0XHRcdGlzT25lVG9PbmVNYXBwaW5nTW9kZSB8fCBOdW1iZXIoaWR4KSAlIDIgPT09IDA7XG5cdFx0XHRcdFx0XHRpZiAoaXNUcmFuc2xhdGlvbikge1xuXHRcdFx0XHRcdFx0XHRyZXN1bHQucHVzaCh0ZXh0KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAocmVzdWx0Lmxlbmd0aCAhPT0gdGV4dC5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybignVHJhbnNsYXRpb24gcmVzdWx0JywgcmVzdWx0KTtcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0XHRcdFx0J01pc21hdGNoaW5nIGEgbGVuZ3RocyBvZiBvcmlnaW5hbCBhbmQgdHJhbnNsYXRlZCBhcnJheXMnLFxuXHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0IGFzIHN0cmluZ1tdO1xuXHRcdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oJ0dvdCByZXNwb25zZScsIHJhd1Jlc3ApO1xuXHRcdFx0XHRcdHRocm93IGVycjtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdH1cbn1cbiJdfQ==
